<?php

declare(strict_types=1);

namespace Mittwald\ApiClient\Generated\V2\Schemas\Container;

use InvalidArgumentException;
use JsonSchema\Validator;

/**
 * Auto-generated class for de.mittwald.v1.container.ServiceDeclareRequest.
 *
 * DO NOT EDIT; this class was generated by the mittwald/api-client-builder package
 * (https://github.com/mittwald/api-client-php-builder). Please make any changes
 * there.
 *
 * @generated
 * @see https://github.com/mittwald/api-client-php-builder
 */
class ServiceDeclareRequest
{
    /**
     * Schema used to validate input for creating instances of this class
     */
    private static array $internalValidationSchema = [
        'properties' => [
            'command' => [
                'description' => 'The container command (equivalent to the [Docker cmd](https://docs.docker.com/reference/dockerfile/#cmd)). When omitted, this defaults to the command defined in the image.
',
                'example' => [
                    'mysqld',
                ],
                'items' => [
                    'type' => 'string',
                ],
                'type' => 'array',
            ],
            'deploy' => [
                '$ref' => '#/components/schemas/de.mittwald.v1.container.Deploy',
            ],
            'description' => [
                'example' => 'MySQL DB',
                'type' => 'string',
            ],
            'entrypoint' => [
                'description' => 'The container entrypoint (equivalent to the [Docker entrypoint](https://docs.docker.com/reference/dockerfile/#entrypoint)). When omitted, this defaults to the entrypoint defined in the image.
',
                'example' => [
                    'docker-entrypoint.sh',
                ],
                'items' => [
                    'type' => 'string',
                ],
                'type' => 'array',
            ],
            'environment' => [
                'additionalProperties' => [
                    'type' => 'string',
                ],
                'description' => 'Key-value map of environment variables that should be passed into the container.
',
                'example' => [
                    'MYSQL_DATABASE' => 'my_db',
                    'MYSQL_PASSWORD' => 'my_password',
                    'MYSQL_ROOT_PASSWORD' => 'my_root_password',
                    'MYSQL_USER' => 'my_user',
                ],
                'type' => 'object',
            ],
            'envs' => [
                'additionalProperties' => [
                    'type' => 'string',
                ],
                'deprecated' => true,
                'description' => 'DEPRECATED: Use \'environment\' instead. This field will be removed in a future version.',
                'example' => [
                    'MYSQL_DATABASE' => 'my_db',
                    'MYSQL_PASSWORD' => 'my_password',
                    'MYSQL_ROOT_PASSWORD' => 'my_root_password',
                    'MYSQL_USER' => 'my_user',
                ],
                'type' => 'object',
            ],
            'image' => [
                'description' => 'The image to run, in the usual format also used by `docker run` and `docker compose`. When
the image is pulled from a private registry, make sure to create the registry first
using the `container-create-registry` endpoint (you can push the image later, although
the container will remain in a pending state until the image is actually available).

The appropriate registry is matched by hostname.
',
                'example' => 'mysql:8.0',
                'type' => 'string',
            ],
            'ports' => [
                'description' => 'Exposed ports. Follows the format `<public-port>:<container-port>/<protocol>`. Exposed ports can be accessed from other containers (or managed apps) within the same project. To expose a port publicly, connect it with an ingress resource.
',
                'example' => [
                    '3306/tcp',
                ],
                'items' => [
                    'type' => 'string',
                ],
                'type' => 'array',
            ],
            'volumes' => [
                'description' => 'Volume mounts for this container. These items always follow the format `<volume>:<mountpoint>`. The `<volume>` may either be a named volume, or a file path in the (always present) project file system (which is shared among containers and managed apps within a project).
',
                'example' => [
                    'data:/var/lib/mysql:ro',
                    '/home/p-XXXXX/html:/var/www',
                ],
                'items' => [
                    'type' => 'string',
                ],
                'type' => 'array',
            ],
        ],
        'required' => [
            'image',
        ],
        'type' => 'object',
    ];

    /**
     * The container command (equivalent to the [Docker cmd](https://docs.docker.com/reference/dockerfile/#cmd)). When omitted, this defaults to the command defined in the image.
     *
     *
     * @var string[]|null
     */
    private ?array $command = null;

    private ?Deploy $deploy = null;

    private ?string $description = null;

    /**
     * The container entrypoint (equivalent to the [Docker entrypoint](https://docs.docker.com/reference/dockerfile/#entrypoint)). When omitted, this defaults to the entrypoint defined in the image.
     *
     *
     * @var string[]|null
     */
    private ?array $entrypoint = null;

    /**
     * Key-value map of environment variables that should be passed into the container.
     *
     *
     * @var string[]|null
     */
    private ?array $environment = null;

    /**
     * DEPRECATED: Use 'environment' instead. This field will be removed in a future version.
     *
     * @var string[]|null
     * @deprecated
     */
    private ?array $envs = null;

    /**
     * The image to run, in the usual format also used by `docker run` and `docker compose`. When
     * the image is pulled from a private registry, make sure to create the registry first
     * using the `container-create-registry` endpoint (you can push the image later, although
     * the container will remain in a pending state until the image is actually available).
     *
     * The appropriate registry is matched by hostname.
     *
     */
    private string $image;

    /**
     * Exposed ports. Follows the format `<public-port>:<container-port>/<protocol>`. Exposed ports can be accessed from other containers (or managed apps) within the same project. To expose a port publicly, connect it with an ingress resource.
     *
     *
     * @var string[]|null
     */
    private ?array $ports = null;

    /**
     * Volume mounts for this container. These items always follow the format `<volume>:<mountpoint>`. The `<volume>` may either be a named volume, or a file path in the (always present) project file system (which is shared among containers and managed apps within a project).
     *
     *
     * @var string[]|null
     */
    private ?array $volumes = null;

    public function __construct(string $image)
    {
        $this->image = $image;
    }

    /**
     * @return string[]|null
     */
    public function getCommand(): ?array
    {
        return $this->command ?? null;
    }

    public function getDeploy(): ?Deploy
    {
        return $this->deploy ?? null;
    }

    public function getDescription(): ?string
    {
        return $this->description ?? null;
    }

    /**
     * @return string[]|null
     */
    public function getEntrypoint(): ?array
    {
        return $this->entrypoint ?? null;
    }

    /**
     * @return string[]|null
     */
    public function getEnvironment(): ?array
    {
        return $this->environment ?? null;
    }

    /**
     * @return string[]|null
     * @deprecated
     */
    public function getEnvs(): ?array
    {
        return $this->envs ?? null;
    }

    public function getImage(): string
    {
        return $this->image;
    }

    /**
     * @return string[]|null
     */
    public function getPorts(): ?array
    {
        return $this->ports ?? null;
    }

    /**
     * @return string[]|null
     */
    public function getVolumes(): ?array
    {
        return $this->volumes ?? null;
    }

    /**
     * @param string[] $command
     */
    public function withCommand(array $command): self
    {
        $validator = new Validator();
        $validator->validate($command, self::$internalValidationSchema['properties']['command']);
        if (!$validator->isValid()) {
            throw new InvalidArgumentException($validator->getErrors()[0]['message']);
        }

        $clone = clone $this;
        $clone->command = $command;

        return $clone;
    }

    public function withoutCommand(): self
    {
        $clone = clone $this;
        unset($clone->command);

        return $clone;
    }

    public function withDeploy(Deploy $deploy): self
    {
        $clone = clone $this;
        $clone->deploy = $deploy;

        return $clone;
    }

    public function withoutDeploy(): self
    {
        $clone = clone $this;
        unset($clone->deploy);

        return $clone;
    }

    public function withDescription(string $description): self
    {
        $validator = new Validator();
        $validator->validate($description, self::$internalValidationSchema['properties']['description']);
        if (!$validator->isValid()) {
            throw new InvalidArgumentException($validator->getErrors()[0]['message']);
        }

        $clone = clone $this;
        $clone->description = $description;

        return $clone;
    }

    public function withoutDescription(): self
    {
        $clone = clone $this;
        unset($clone->description);

        return $clone;
    }

    /**
     * @param string[] $entrypoint
     */
    public function withEntrypoint(array $entrypoint): self
    {
        $validator = new Validator();
        $validator->validate($entrypoint, self::$internalValidationSchema['properties']['entrypoint']);
        if (!$validator->isValid()) {
            throw new InvalidArgumentException($validator->getErrors()[0]['message']);
        }

        $clone = clone $this;
        $clone->entrypoint = $entrypoint;

        return $clone;
    }

    public function withoutEntrypoint(): self
    {
        $clone = clone $this;
        unset($clone->entrypoint);

        return $clone;
    }

    /**
     * @param string[] $environment
     */
    public function withEnvironment(array $environment): self
    {
        $validator = new Validator();
        $validator->validate($environment, self::$internalValidationSchema['properties']['environment']);
        if (!$validator->isValid()) {
            throw new InvalidArgumentException($validator->getErrors()[0]['message']);
        }

        $clone = clone $this;
        $clone->environment = $environment;

        return $clone;
    }

    public function withoutEnvironment(): self
    {
        $clone = clone $this;
        unset($clone->environment);

        return $clone;
    }

    /**
     * @param string[] $envs
     * @deprecated
     */
    public function withEnvs(array $envs): self
    {
        $validator = new Validator();
        $validator->validate($envs, self::$internalValidationSchema['properties']['envs']);
        if (!$validator->isValid()) {
            throw new InvalidArgumentException($validator->getErrors()[0]['message']);
        }

        $clone = clone $this;
        $clone->envs = $envs;

        return $clone;
    }

    public function withoutEnvs(): self
    {
        $clone = clone $this;
        unset($clone->envs);

        return $clone;
    }

    public function withImage(string $image): self
    {
        $validator = new Validator();
        $validator->validate($image, self::$internalValidationSchema['properties']['image']);
        if (!$validator->isValid()) {
            throw new InvalidArgumentException($validator->getErrors()[0]['message']);
        }

        $clone = clone $this;
        $clone->image = $image;

        return $clone;
    }

    /**
     * @param string[] $ports
     */
    public function withPorts(array $ports): self
    {
        $validator = new Validator();
        $validator->validate($ports, self::$internalValidationSchema['properties']['ports']);
        if (!$validator->isValid()) {
            throw new InvalidArgumentException($validator->getErrors()[0]['message']);
        }

        $clone = clone $this;
        $clone->ports = $ports;

        return $clone;
    }

    public function withoutPorts(): self
    {
        $clone = clone $this;
        unset($clone->ports);

        return $clone;
    }

    /**
     * @param string[] $volumes
     */
    public function withVolumes(array $volumes): self
    {
        $validator = new Validator();
        $validator->validate($volumes, self::$internalValidationSchema['properties']['volumes']);
        if (!$validator->isValid()) {
            throw new InvalidArgumentException($validator->getErrors()[0]['message']);
        }

        $clone = clone $this;
        $clone->volumes = $volumes;

        return $clone;
    }

    public function withoutVolumes(): self
    {
        $clone = clone $this;
        unset($clone->volumes);

        return $clone;
    }

    /**
     * Builds a new instance from an input array
     *
     * @param array|object $input Input data
     * @param bool $validate Set this to false to skip validation; use at own risk
     * @return ServiceDeclareRequest Created instance
     * @throws InvalidArgumentException
     */
    public static function buildFromInput(array|object $input, bool $validate = true): ServiceDeclareRequest
    {
        $input = is_array($input) ? Validator::arrayToObjectRecursive($input) : $input;
        if ($validate) {
            static::validateInput($input);
        }

        $command = null;
        if (isset($input->{'command'})) {
            $command = $input->{'command'};
        }
        $deploy = null;
        if (isset($input->{'deploy'})) {
            $deploy = Deploy::buildFromInput($input->{'deploy'}, validate: $validate);
        }
        $description = null;
        if (isset($input->{'description'})) {
            $description = $input->{'description'};
        }
        $entrypoint = null;
        if (isset($input->{'entrypoint'})) {
            $entrypoint = $input->{'entrypoint'};
        }
        $environment = null;
        if (isset($input->{'environment'})) {
            $environment = (array)$input->{'environment'};
        }
        $envs = null;
        if (isset($input->{'envs'})) {
            $envs = (array)$input->{'envs'};
        }
        $image = $input->{'image'};
        $ports = null;
        if (isset($input->{'ports'})) {
            $ports = $input->{'ports'};
        }
        $volumes = null;
        if (isset($input->{'volumes'})) {
            $volumes = $input->{'volumes'};
        }

        $obj = new self($image);
        $obj->command = $command;
        $obj->deploy = $deploy;
        $obj->description = $description;
        $obj->entrypoint = $entrypoint;
        $obj->environment = $environment;
        $obj->envs = $envs;
        $obj->ports = $ports;
        $obj->volumes = $volumes;
        return $obj;
    }

    /**
     * Converts this object back to a simple array that can be JSON-serialized
     *
     * @return array Converted array
     */
    public function toJson(): array
    {
        $output = [];
        if (isset($this->command)) {
            $output['command'] = $this->command;
        }
        if (isset($this->deploy)) {
            $output['deploy'] = $this->deploy->toJson();
        }
        if (isset($this->description)) {
            $output['description'] = $this->description;
        }
        if (isset($this->entrypoint)) {
            $output['entrypoint'] = $this->entrypoint;
        }
        if (isset($this->environment)) {
            $output['environment'] = $this->environment;
        }
        if (isset($this->envs)) {
            $output['envs'] = $this->envs;
        }
        $output['image'] = $this->image;
        if (isset($this->ports)) {
            $output['ports'] = $this->ports;
        }
        if (isset($this->volumes)) {
            $output['volumes'] = $this->volumes;
        }

        return $output;
    }

    /**
     * Validates an input array
     *
     * @param array|object $input Input data
     * @param bool $return Return instead of throwing errors
     * @return bool Validation result
     * @throws InvalidArgumentException
     */
    public static function validateInput(array|object $input, bool $return = false): bool
    {
        $validator = new \Mittwald\ApiClient\Validator\Validator();
        $input = is_array($input) ? Validator::arrayToObjectRecursive($input) : $input;
        $validator->validate($input, self::$internalValidationSchema);

        if (!$validator->isValid() && !$return) {
            $errors = array_map(function (array $e): string {
                return $e["property"] . ": " . $e["message"];
            }, $validator->getErrors());
            throw new InvalidArgumentException(join(", ", $errors));
        }

        return $validator->isValid();
    }

    public function __clone()
    {
    }
}
